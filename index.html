<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>课程反馈快捷编辑系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            /* 修改1: 添加随机二次元背景图，每次刷新页面都会不同 */
            background-image: url('https://www.dmoe.cc/random.php');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #333;
            line-height: 1.6;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
            -webkit-text-size-adjust: 100%;
            min-height: 100vh;
        }
        
        .container {
            /* 修改2: 添加半透明背景确保内容可读性 */
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin-bottom: 20px;
            backdrop-filter: blur(3px);
        }
        
        header {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.4;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px 15px;
        }
        
        .left-panel {
            flex: 1;
            min-width: 300px;
            padding-right: 15px;
        }
        
        .right-panel {
            flex: 1;
            min-width: 300px;
            border-left: 1px solid #eee;
            padding-left: 15px;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #4b6cb7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title i {
            color: #4b6cb7;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #4b6cb7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 12px;
        }
        
        .search-box i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }
        
        .category-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .category-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 10px 16px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px 6px 0 0;
            margin-right: 4px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.9rem;
        }
        
        .tab.active {
            background: #4b6cb7;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        .phrase-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        .phrase-item {
            padding: 10px 12px;
            border-bottom: 1px solid #f1f1f1;
            cursor: pointer;
            transition: background 0.2s;
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        
        .phrase-item:hover {
            background-color: #f0f7ff;
        }
        
        .phrase-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #4b6cb7;
        }
        
        .phrase-item .category {
            display: inline-block;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-right: 6px;
            color: #555;
        }
        
        .phrase-item.math .category {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .phrase-item.chinese .category {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .phrase-item.english .category {
            background: #e8f5e9;
            color: #388e3c;
        }
        
        .phrase-item.physics .category {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .phrase-item.chemistry .category {
            background: #e8eaf6;
            color: #303f9f;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 18px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex: 1;
            min-width: 120px;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #4b6cb7, #182848);
            color: white;
        }
        
        .btn-primary:hover, .btn-primary:active {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: #e9ecef;
        }
        
        .btn-tertiary {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }
        
        .btn-tertiary:hover, .btn-tertiary:active {
            background: #bbdefb;
        }
        
        .preview-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            margin-top: 18px;
            white-space: pre-wrap;
            font-family: 'Segoe UI', sans-serif;
            line-height: 1.7;
            min-height: 250px;
            border: 1px solid #e9ecef;
            font-size: 0.95rem;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        .preview-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #2c3e50;
            text-align: center;
        }
        
        .student-info {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 18px;
        }
        
        .student-info .form-group {
            flex: 1;
            min-width: 180px;
        }
        
        .subject-section {
            margin-bottom: 20px;
            padding: 18px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none; /* 默认隐藏所有学科 */
        }
        
        .subject-section.active {
            display: block; /* 显示当前活动学科 */
        }
        
        .subject-section h3 {
            color: #2c3e50;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .phrase-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .phrase-controls select {
            flex: 1;
            min-width: 120px;
        }
        
        .phrase-controls button {
            padding: 8px 12px;
            background: #4b6cb7;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
        }
        
        .phrase-controls button:hover {
            background: #3a559f;
        }
        
        .local-indicator {
            background: #ffeb3b;
            color: #333;
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 0.7rem;
            margin-left: 4px;
        }
        
        .text-display {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            min-height: 55px;
            margin-bottom: 8px;
            line-height: 1.5;
            font-size: 0.9rem;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        .text-display.empty {
            color: #999;
            font-style: italic;
        }
        
        .subject-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .subject-controls button {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.3s;
            flex: 1;
        }
        
        .subject-controls .edit-btn {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .subject-controls .edit-btn:hover, .subject-controls .edit-btn:active {
            background: #bbdefb;
        }
        
        .subject-controls .clear-btn {
            background: #ffebee;
            color: #d32f2f;
        }
        
        .subject-controls .clear-btn:hover, .subject-controls .clear-btn:active {
            background: #ffcdd2;
        }
        
        .current-selections {
            margin-top: 4px;
            font-size: 0.85rem;
            color: #666;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 8px 12px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            flex: 1;
        }
        
        .file-label:hover, .file-label:active {
            background: #bbdefb;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .toast.show {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 右侧学科切换标签 */
        .right-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .right-tab {
            padding: 8px 14px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px 6px 0 0;
            margin-right: 4px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.85rem;
        }
        
        .right-tab.active {
            background: #4b6cb7;
            color: white;
        }
        
        .right-tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        .right-subject-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #4b6cb7;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .right-subject-title i {
            color: #4b6cb7;
        }
        
        /* 手机适配优化 */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                padding: 15px 10px;
            }
            
            .left-panel, .right-panel {
                padding: 0;
                border: none;
                width: 100%;
            }
            
            .right-panel {
                margin-top: 20px;
                border-top: 1px solid #eee;
                padding-top: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .student-info {
                flex-direction: column;
            }
            
            .phrase-controls {
                flex-direction: column;
            }
            
            .phrase-controls select {
                width: 100%;
            }
            
            header {
                padding: 15px 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .subject-section h3 {
                font-size: 1.1rem;
            }
            
            .preview-box {
                padding: 15px;
                font-size: 0.9rem;
            }
            
            .text-display {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .right-tabs {
                margin-bottom: 10px;
            }
            
            .right-tab {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            /* 手机端背景优化 */
            body {
                background-attachment: scroll;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 8px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .phrase-item {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
            
            .preview-box {
                min-height: 200px;
            }
        }
        
        /* 防止iOS输入框放大 */
        @media screen and (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chalkboard-teacher"></i> OuKinKin系统</h1>
            <p class="subtitle">支持语文、数学、英语、物理、化学多学科反馈生成，内置丰富语库，支持本地存储与首字母搜索</p>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="form-group student-info">
                    <div class="form-group">
                        <label for="studentName"><i class="fas fa-user"></i> 学生姓名</label>
                        <input type="text" id="studentName" placeholder="请输入学生姓名" value="智豪">
                    </div>
                    <div class="form-group">
                        <label for="feedbackDate"><i class="fas fa-calendar-alt"></i> 反馈日期</label>
                        <input type="date" id="feedbackDate">
                    </div>
                </div>
                
                <div class="category-tabs">
                    <button class="tab active" data-category="math">数学</button>
                    <button class="tab" data-category="chinese">语文</button>
                    <button class="tab" data-category="english">英语</button>
                    <button class="tab" data-category="physics">物理</button>
                    <button class="tab" data-category="chemistry">化学</button>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-search"></i> 首字母搜索套话</label>
                    <div class="search-box">
                        <input type="text" id="phraseSearch" placeholder="输入首字母或关键词搜索 (例如: 'js' 或 '计算')">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="phrase-list" id="phraseList">
                        <!-- 短语列表将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-plus-circle"></i> 添加自定义短语到本地库</label>
                    <div class="phrase-controls">
                        <select id="customCategory">
                            <option value="math">数学</option>
                            <option value="chinese">语文</option>
                            <option value="english">英语</option>
                            <option value="physics">物理</option>
                            <option value="chemistry">化学</option>
                        </select>
                        <select id="customType">
                            <option value="homework_status">作业状态</option>
                            <option value="problem">问题点</option>
                            <option value="suggestion">后续建议</option>
                        </select>
                        <input type="text" id="customPhrase" placeholder="输入自定义短语">
                        <button id="addCustomPhrase"><i class="fas fa-plus"></i> 添加</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-database"></i> 本地词库管理</label>
                    <div class="action-buttons">
                        <button class="btn btn-tertiary" id="exportBtn">
                            <i class="fas fa-download"></i> 导出词库
                        </button>
                        <label for="importFile" class="file-label">
                            <i class="fas fa-upload"></i> 导入词库
                        </label>
                        <input type="file" id="importFile" class="file-input" accept=".json">
                    </div>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 8px;">导出词库保存为JSON文件，可从其他设备导入</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo"></i> 重置所有选择
                    </button>
                    <button class="btn btn-primary" id="generateBtn">
                        <i class="fas fa-magic"></i> 生成课程反馈
                    </button>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="right-tabs" id="rightTabs">
                    <!-- 右侧学科切换标签将通过JavaScript动态生成 -->
                </div>
                
                <div class="right-subject-title" id="rightSubjectTitle">
                    <i class="fas fa-edit"></i> <span id="currentSubjectName">数学</span>反馈编辑
                </div>
                
                <div class="subject-section active" id="mathSection">
                    <h3><i class="fas fa-calculator"></i> 数学反馈</h3>
                    <div class="form-group">
                        <label>作业状态 <span class="current-selections" id="mathHomeworkStatusDisplay">未选择</span></label>
                        <div class="text-display empty" id="mathHomeworkText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="math" data-type="homework_status">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="math" data-type="homework_status">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>问题点 <span class="current-selections" id="mathProblemDisplay">未选择</span></label>
                        <div class="text-display empty" id="mathProblemText">点击左侧短语添加（可添加多个）</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="math" data-type="problem">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="math" data-type="problem">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>后续建议 <span class="current-selections" id="mathSuggestionDisplay">未选择</span></label>
                        <div class="text-display empty" id="mathSuggestionText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="math" data-type="suggestion">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="math" data-type="suggestion">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="subject-section" id="chineseSection">
                    <h3><i class="fas fa-book-open"></i> 语文反馈</h3>
                    <div class="form-group">
                        <label>作业状态 <span class="current-selections" id="chineseHomeworkStatusDisplay">未选择</span></label>
                        <div class="text-display empty" id="chineseHomeworkText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="chinese" data-type="homework_status">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="chinese" data-type="homework_status">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>问题点 <span class="current-selections" id="chineseProblemDisplay">未选择</span></label>
                        <div class="text-display empty" id="chineseProblemText">点击左侧短语添加（可添加多个）</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="chinese" data-type="problem">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="chinese" data-type="problem">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>后续建议 <span class="current-selections" id="chineseSuggestionDisplay">未选择</span></label>
                        <div class="text-display empty" id="chineseSuggestionText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="chinese" data-type="suggestion">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="chinese" data-type="suggestion">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="subject-section" id="englishSection">
                    <h3><i class="fas fa-language"></i> 英语反馈</h3>
                    <div class="form-group">
                        <label>作业状态 <span class="current-selections" id="englishHomeworkStatusDisplay">未选择</span></label>
                        <div class="text-display empty" id="englishHomeworkText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="english" data-type="homework_status">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="english" data-type="homework_status">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>问题点 <span class="current-selections" id="englishProblemDisplay">未选择</span></label>
                        <div class="text-display empty" id="englishProblemText">点击左侧短语添加（可添加多个）</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="english" data-type="problem">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="english" data-type="problem">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>后续建议 <span class="current-selections" id="englishSuggestionDisplay">未选择</span></label>
                        <div class="text-display empty" id="englishSuggestionText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="english" data-type="suggestion">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="english" data-type="suggestion">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="subject-section" id="physicsSection">
                    <h3><i class="fas fa-atom"></i> 物理反馈</h3>
                    <div class="form-group">
                        <label>作业状态 <span class="current-selections" id="physicsHomeworkStatusDisplay">未选择</span></label>
                        <div class="text-display empty" id="physicsHomeworkText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="physics" data-type="homework_status">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="physics" data-type="homework_status">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>问题点 <span class="current-selections" id="physicsProblemDisplay">未选择</span></label>
                        <div class="text-display empty" id="physicsProblemText">点击左侧短语添加（可添加多个）</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="physics" data-type="problem">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="physics" data-type="problem">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>后续建议 <span class="current-selections" id="physicsSuggestionDisplay">未选择</span></label>
                        <div class="text-display empty" id="physicsSuggestionText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="physics" data-type="suggestion">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="physics" data-type="suggestion">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="subject-section" id="chemistrySection">
                    <h3><i class="fas fa-flask"></i> 化学反馈</h3>
                    <div class="form-group">
                        <label>作业状态 <span class="current-selections" id="chemistryHomeworkStatusDisplay">未选择</span></label>
                        <div class="text-display empty" id="chemistryHomeworkText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="chemistry" data-type="homework_status">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="chemistry" data-type="homework_status">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>问题点 <span class="current-selections" id="chemistryProblemDisplay">未选择</span></label>
                        <div class="text-display empty" id="chemistryProblemText">点击左侧短语添加（可添加多个）</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="chemistry" data-type="problem">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="chemistry" data-type="problem">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>后续建议 <span class="current-selections" id="chemistrySuggestionDisplay">未选择</span></label>
                        <div class="text-display empty" id="chemistrySuggestionText">点击左侧短语添加</div>
                        <div class="subject-controls">
                            <button class="edit-btn" data-subject="chemistry" data-type="suggestion">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="clear-btn" data-subject="chemistry" data-type="suggestion">
                                <i class="fas fa-times"></i> 清空
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-sticky-note"></i> 额外备注</label>
                    <textarea id="additionalNotes" placeholder="可在此添加额外的备注信息..."></textarea>
                </div>
                
                <h2 class="section-title"><i class="fas fa-eye"></i> 反馈预览</h2>
                <div class="preview-box" id="feedbackPreview">
                    <div class="preview-title">生成的反馈内容将在此显示</div>
                    <p>请填写学生信息并选择各学科反馈内容，然后点击"生成课程反馈"按钮。</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="copyBtn">
                        <i class="fas fa-copy"></i> 复制到剪贴板
                    </button>
                    <button class="btn btn-primary" id="saveLocalBtn">
                        <i class="fas fa-save"></i> 保存到本地语库
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">操作成功！</span>
    </div>

    <script>
        // 当前选择的短语存储
        let currentSelections = {
            math: {
                homework_status: null,
                problem: [],
                suggestion: null
            },
            chinese: {
                homework_status: null,
                problem: [],
                suggestion: null
            },
            english: {
                homework_status: null,
                problem: [],
                suggestion: null
            },
            physics: {
                homework_status: null,
                problem: [],
                suggestion: null
            },
            chemistry: {
                homework_status: null,
                problem: [],
                suggestion: null
            }
        };
        
        // 内置语库数据
        const builtInPhrases = {
            math: {
                homework_status: [
                    { id: 'math_hw1', text: '数学作业已完成', pinyin: 'sxzyyqw' },
                    { id: 'math_hw2', text: '数学作业已完成，但部分题目需要订正', pinyin: 'sxzyyqwdbf' },
                    { id: 'math_hw3', text: '数学作业已完成，正确率较高', pinyin: 'sxzyyqwzqj' },
                    { id: 'math_hw4', text: '数学作业未完成，计划明天继续', pinyin: 'sxzywwcjh' },
                    { id: 'math_hw5', text: '数学作业已完成，但时间超出计划', pinyin: 'sxzyyqwsjcc' }
                ],
                problem: [
                    { id: 'math_p1', text: '找规律', pinyin: 'gzgl' },
                    { id: 'math_p2', text: '分类讨论不清晰', pinyin: 'fltlbqx' },
                    { id: 'math_p3', text: '直线到坐标轴的距离问题', pinyin: 'zxdzbzxjl' },
                    { id: 'math_p4', text: '一次函数图像理解不透彻', pinyin: 'ychstxljbtc' },
                    { id: 'math_p5', text: '解方程计算错误较多', pinyin: 'jfcjscwjd' },
                    { id: 'math_p6', text: '几何证明题思路不清晰', pinyin: 'jhzmtlslbqx' },
                    { id: 'math_p7', text: '应用题理解题意有困难', pinyin: 'yytljtyykn' },
                    { id: 'math_p8', text: '概率问题计算不熟练', pinyin: 'glwtjsbsl' },
                    { id: 'math_p9', text: '函数定义域和值域混淆', pinyin: 'hsdyyzyhx' },
                    { id: 'math_p10', text: '平面直角坐标系应用不熟练', pinyin: 'pmzjzbxyybsl' },
                    { id: 'math_p11', text: '整式运算错误', pinyin: 'zsyscw' },
                    { id: 'math_p12', text: '因式分解方法不熟练', pinyin: 'ysfjffbsl' },
                    { id: 'math_p13', text: '不等式性质应用错误', pinyin: 'bdsxzyycw' },
                    { id: 'math_p14', text: '二次函数最值问题', pinyin: 'echszzwt' },
                    { id: 'math_p15', text: '相似三角形判定不熟练', pinyin: 'xssjxpdbsl' }
                ],
                suggestion: [
                    { id: 'math_s1', text: '已给讲解，周末可以进行一下针对练习', pinyin: 'ygjjzmkyjxdzdlx' },
                    { id: 'math_s2', text: '准备好一个16k的笔记本，题目已给留好，需要根据内容复习一下知识点', pinyin: 'zbygbjb' },
                    { id: 'math_s3', text: '回去重新计算错题，下次注意检查', pinyin: 'hqcxjsct' },
                    { id: 'math_s4', text: '多做同类型题目，加强练习', pinyin: 'dztlxtmqjlx' },
                    { id: 'math_s5', text: '需要巩固基础知识，特别是公式记忆', pinyin: 'xyggjczhts' },
                    { id: 'math_s6', text: '建议制作错题本，定期复习', pinyin: 'jyzzctbdqfx' },
                    { id: 'math_s7', text: '加强函数图像的理解，多画图分析', pinyin: 'jqchstxljdh' },
                    { id: 'math_s8', text: '学习解题方法，注意步骤规范性', pinyin: 'xxjffbz' }
                ]
            },
            chinese: {
                homework_status: [
                    { id: 'chinese_hw1', text: '语文作业已完成', pinyin: 'ywzyyqw' },
                    { id: 'chinese_hw2', text: '语文作业未完成', pinyin: 'ywzywwc' },
                    { id: 'chinese_hw3', text: '语文作业完成质量较高', pinyin: 'ywzywczl' }
                ],
                problem: [
                    { id: 'chinese_p1', text: '古诗文默写有错误', pinyin: 'gswmxycw' },
                    { id: 'chinese_p2', text: '阅读理解答题不完整', pinyin: 'ydljdqjbwz' },
                    { id: 'chinese_p3', text: '作文结构不清晰', pinyin: 'zwjgbqx' },
                    { id: 'chinese_p4', text: '字词书写不规范', pinyin: 'zcsxbgf' },
                    { id: 'chinese_p5', text: '文言文翻译不准确', pinyin: 'wywfybzz' }
                ],
                suggestion: [
                    { id: 'chinese_s1', text: '多背诵古诗文，加强记忆', pinyin: 'dbssgswjqjy' },
                    { id: 'chinese_s2', text: '多阅读，提高理解能力', pinyin: 'dydtgjlnl' },
                    { id: 'chinese_s3', text: '练习作文提纲的编写', pinyin: 'lxzwtgbx' }
                ]
            },
            english: {
                homework_status: [
                    { id: 'english_hw1', text: '英语作业已完成', pinyin: 'yyzyyqw' },
                    { id: 'english_hw2', text: '英语作业未完成', pinyin: 'yyzywwc' },
                    { id: 'english_hw3', text: '英语作业今天发写很多，耽误了很长时间', pinyin: 'yyzyjtfxhd' }
                ],
                problem: [
                    { id: 'english_p1', text: '单词拼写错误较多', pinyin: 'dcpxcwjd' },
                    { id: 'english_p2', text: '语法概念不清楚', pinyin: 'yfgmbqc' },
                    { id: 'english_p3', text: '阅读理解答题不准确', pinyin: 'ydljdqjbzz' },
                    { id: 'english_p4', text: '听力部分得分较低', pinyin: 'tlbfdfjd' },
                    { id: 'english_p5', text: '作文句式单一', pinyin: 'zwjsdy' }
                ],
                suggestion: [
                    { id: 'english_s1', text: '每天背诵10个新单词', pinyin: 'mtbsxgxdc' },
                    { id: 'english_s2', text: '多听英语材料，培养语感', pinyin: 'dtyyclpyyg' },
                    { id: 'english_s3', text: '练习英语写作，多样化句式', pinyin: 'lxyyxzdyhjs' }
                ]
            },
            physics: {
                homework_status: [
                    { id: 'physics_hw1', text: '物理作业已完成', pinyin: 'wlzyyqw' },
                    { id: 'physics_hw2', text: '物理作业未完成', pinyin: 'wlzywwc' },
                    { id: 'physics_hw3', text: '物理作业完成质量较高', pinyin: 'wlzywczl' },
                    { id: 'physics_hw4', text: '物理实验报告已完成', pinyin: 'wlsybgyqw' }
                ],
                problem: [
                    { id: 'physics_p1', text: '力学分析不清晰', pinyin: 'lxfbxqx' },
                    { id: 'physics_p2', text: '受力分析图绘制不准确', pinyin: 'slfxtbzbzz' },
                    { id: 'physics_p3', text: '公式记忆不牢固', pinyin: 'gsjyblg' },
                    { id: 'physics_p4', text: '物理概念理解不透彻', pinyin: 'wlgntjbtc' },
                    { id: 'physics_p5', text: '能量守恒定律应用错误', pinyin: 'nlshdlyycw' },
                    { id: 'physics_p6', text: '电路图分析能力较弱', pinyin: 'dltfxnljr' },
                    { id: 'physics_p7', text: '电磁学概念混淆', pinyin: 'dcxgnhx' },
                    { id: 'physics_p8', text: '运动学公式应用不熟练', pinyin: 'ydxgnyybsl' }
                ],
                suggestion: [
                    { id: 'physics_s1', text: '加强受力分析训练，多画图', pinyin: 'jqslfx' },
                    { id: 'physics_s2', text: '记忆物理公式，理解其物理意义', pinyin: 'jywlgsljqwl' },
                    { id: 'physics_s3', text: '多做典型例题，掌握解题思路', pinyin: 'dzdxltz' },
                    { id: 'physics_s4', text: '结合实际生活理解物理现象', pinyin: 'jjsjshljw' }
                ]
            },
            chemistry: {
                homework_status: [
                    { id: 'chemistry_hw1', text: '化学作业已完成', pinyin: 'hxzyyqw' },
                    { id: 'chemistry_hw2', text: '化学作业未完成', pinyin: 'hxzywwc' },
                    { id: 'chemistry_hw3', text: '化学实验报告已完成', pinyin: 'hxsybgyqw' },
                    { id: 'chemistry_hw4', text: '化学方程式默写完成', pinyin: 'hxfcsxmxw' }
                ],
                problem: [
                    { id: 'chemistry_p1', text: '化学方程式书写错误', pinyin: 'hxfcsxsxcw' },
                    { id: 'chemistry_p2', text: '元素周期表记忆不熟', pinyin: 'yszqbjlbs' },
                    { id: 'chemistry_p3', text: '化学反应原理不理解', pinyin: 'hxfyyllbj' },
                    { id: 'chemistry_p4', text: '化学计算题步骤不完整', pinyin: 'hxjstbzbwz' },
                    { id: 'chemistry_p5', text: '物质性质记忆混淆', pinyin: 'wzxzjyhx' },
                    { id: 'chemistry_p6', text: '实验操作步骤不清晰', pinyin: 'syczbzbqx' },
                    { id: 'chemistry_p7', text: '有机化学命名规则不熟', pinyin: 'yjhxmmgzb' },
                    { id: 'chemistry_p8', text: '化学平衡理解不到位', pinyin: 'hxphljdw' }
                ],
                suggestion: [
                    { id: 'chemistry_s1', text: '加强化学方程式书写训练', pinyin: 'jqhxfcsx' },
                    { id: 'chemistry_s2', text: '记忆常见元素和化合物性质', pinyin: 'jycjyh' },
                    { id: 'chemistry_s3', text: '多做化学计算题，掌握计算方法', pinyin: 'dzhxjst' },
                    { id: 'chemistry_s4', text: '结合实验理解化学原理', pinyin: 'jhsyljhxy' }
                ]
            }
        };

        // 本地语库存储键名
        const LOCAL_STORAGE_KEY = 'course_feedback_phrases';
        
        // 学科名称映射
        const subjectNames = {
            math: '数学',
            chinese: '语文',
            english: '英语',
            physics: '物理',
            chemistry: '化学'
        };
        
        // 获取今天日期的函数
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // 获取本地语库
        function getLocalPhrases() {
            const localData = localStorage.getItem(LOCAL_STORAGE_KEY);
            return localData ? JSON.parse(localData) : {
                math: { homework_status: [], problem: [], suggestion: [] },
                chinese: { homework_status: [], problem: [], suggestion: [] },
                english: { homework_status: [], problem: [], suggestion: [] },
                physics: { homework_status: [], problem: [], suggestion: [] },
                chemistry: { homework_status: [], problem: [], suggestion: [] }
            };
        }
        
        // 保存到本地语库
        function saveToLocalPhrases(phraseData) {
            const localPhrases = getLocalPhrases();
            const { subject, type, text } = phraseData;
            
            // 检查是否已存在
            const exists = localPhrases[subject][type].some(item => item.text === text);
            if (!exists) {
                // 生成拼音缩写
                const pinyin = generatePinyin(text);
                const id = `local_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                localPhrases[subject][type].push({ 
                    id: id, 
                    text, 
                    pinyin,
                    isLocal: true 
                });
                
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(localPhrases));
                return true;
            }
            return false;
        }
        
        // 导出本地词库
        function exportLocalPhrases() {
            const localPhrases = getLocalPhrases();
            const dataStr = JSON.stringify(localPhrases, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `课程反馈词库_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('本地词库已导出为JSON文件');
        }
        
        // 导入本地词库
        function importLocalPhrases(file) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    const currentData = getLocalPhrases();
                    
                    // 合并数据
                    for (const subject in importedData) {
                        if (currentData[subject]) {
                            for (const type in importedData[subject]) {
                                if (currentData[subject][type]) {
                                    // 避免重复添加
                                    importedData[subject][type].forEach(newItem => {
                                        const exists = currentData[subject][type].some(item => item.text === newItem.text);
                                        if (!exists) {
                                            currentData[subject][type].push(newItem);
                                        }
                                    });
                                }
                            }
                        }
                    }
                    
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(currentData));
                    
                    // 重新加载短语列表
                    const currentCategory = document.querySelector('.tab.active').dataset.category;
                    loadPhraseList(currentCategory);
                    
                    showToast('本地词库导入成功！');
                } catch (error) {
                    showToast('导入失败：文件格式不正确');
                    console.error('导入错误:', error);
                }
            };
            
            reader.readAsText(file);
        }
        
        // 生成拼音缩写
        function generatePinyin(text) {
            // 简化的拼音映射
            const pinyinMap = {
                '数': 's', '学': 'x', '作': 'z', '业': 'y', '已': 'y',
                '完': 'w', '成': 'c', '问': 'w', '题': 't', '集': 'j',
                '中': 'z', '在': 'z', '找': 'z', '规': 'g', '律': 'l',
                '分': 'f', '类': 'l', '讨': 't', '论': 'l', '不': 'b',
                '清': 'q', '晰': 'x', '直': 'z', '线': 'x', '到': 'd',
                '坐': 'z', '标': 'b', '轴': 'z', '距': 'j', '离': 'l',
                '语': 'y', '文': 'w', '英': 'y', '计': 'j', '算': 's',
                '错': 'c', '误': 'w', '解': 'j', '方': 'f', '程': 'c',
                '几': 'j', '何': 'h', '证': 'z', '明': 'm', '思': 's',
                '路': 'l', '应': 'y', '用': 'y', '理': 'l', '解': 'j',
                '题': 't', '意': 'y', '困': 'k', '难': 'n', '加': 'j',
                '强': 'q', '练': 'l', '习': 'x', '复': 'f', '知': 'z',
                '识': 's', '点': 'd', '需': 'x', '要': 'y', '巩': 'g',
                '固': 'g', '基': 'j', '础': 'c', '特': 't', '别': 'b',
                '公': 'g', '式': 's', '记': 'j', '忆': 'y', '建': 'j',
                '议': 'y', '制': 'z', '错': 'c', '本': 'b', '定': 'd',
                '期': 'q', '多': 'd', '背': 'b', '诵': 's', '古': 'g',
                '诗': 's', '文': 'w', '阅': 'y', '读': 'd', '答': 'd',
                '结': 'j', '构': 'g', '字': 'z', '词': 'c', '书': 's',
                '写': 'x', '规': 'g', '范': 'f', '翻': 'f', '译': 'y',
                '准': 'z', '确': 'q', '听': 't', '力': 'l', '部': 'b',
                '得': 'd', '较': 'j', '低': 'd', '句': 'j', '式': 's',
                '单': 'd', '一': 'y', '培': 'p', '养': 'y', '感': 'g',
                '写': 'x', '作': 'z', '多': 'd', '样': 'y', '化': 'h',
                '物': 'w', '理': 'l', '化': 'h', '学': 'x', '实': 's',
                '验': 'y', '报': 'b', '告': 'g', '力': 'l', '分': 'f',
                '析': 'x', '受': 's', '图': 't', '绘': 'h', '制': 'z',
                '公': 'g', '式': 's', '记': 'j', '忆': 'y', '牢': 'l',
                '固': 'g', '概': 'g', '念': 'n', '能': 'n', '量': 'l',
                '守': 's', '恒': 'h', '定': 'd', '律': 'l', '电': 'd',
                '路': 'l', '能': 'n', '力': 'l', '较': 'j', '弱': 'r',
                '磁': 'c', '混': 'h', '淆': 'x', '运': 'y', '动': 'd',
                '训': 'x', '练': 'l', '画': 'h', '意': 'y', '义': 'y',
                '型': 'x', '例': 'l', '握': 'w', '解': 'j', '思': 's',
                '结': 'j', '合': 'h', '生': 's', '活': 'h', '现': 'x',
                '象': 'x', '方': 'f', '程': 'c', '式': 's', '元': 'y',
                '素': 's', '周': 'z', '期': 'q', '表': 'b', '反': 'f',
                '应': 'y', '原': 'y', '质': 'z', '性': 'x', '操': 'c',
                '作': 'z', '步': 'b', '骤': 'z', '有': 'y', '机': 'j',
                '命': 'm', '名': 'm', '则': 'z', '平': 'p', '衡': 'h',
                '位': 'w', '常': 'c', '见': 'j', '合': 'h', '掌': 'z',
                '握': 'w', '算': 's', '法': 'f'
            };
            
            return text.split('').map(char => {
                if (/[\u4e00-\u9fa5]/.test(char)) {
                    return pinyinMap[char] || char;
                }
                if (/[a-zA-Z0-9]/.test(char)) {
                    return char.toLowerCase();
                }
                return '';
            }).join('').replace(/\s+/g, '');
        }
        
        // 获取所有短语（内置+本地）
        function getAllPhrases() {
            const localPhrases = getLocalPhrases();
            const allPhrases = JSON.parse(JSON.stringify(builtInPhrases));
            
            // 合并本地语库
            for (const subject in localPhrases) {
                for (const type in localPhrases[subject]) {
                    allPhrases[subject][type] = [
                        ...allPhrases[subject][type],
                        ...localPhrases[subject][type]
                    ];
                }
            }
            
            return allPhrases;
        }
        
        // 初始化页面
        function initPage() {
            // 初始化日期为今天
            const today = getTodayDate();
            document.getElementById('feedbackDate').value = today;
            
            // 初始化右侧学科切换标签
            initRightTabs();
            
            // 加载短语列表显示
            loadPhraseList('math');
            
            // 设置标签页切换
            setupTabs();
            
            // 设置搜索功能
            setupSearch();
            
            // 设置按钮事件
            setupButtonEvents();
            
            // 初始生成预览
            generateFeedback();
        }
        
        // 初始化右侧学科切换标签
        function initRightTabs() {
            const rightTabsContainer = document.getElementById('rightTabs');
            rightTabsContainer.innerHTML = '';
            
            // 创建右侧学科标签
            const subjects = ['math', 'chinese', 'english', 'physics', 'chemistry'];
            
            subjects.forEach(subject => {
                const tab = document.createElement('button');
                tab.className = subject === 'math' ? 'right-tab active' : 'right-tab';
                tab.dataset.subject = subject;
                tab.textContent = subjectNames[subject];
                
                tab.addEventListener('click', function() {
                    // 切换右侧活动标签
                    document.querySelectorAll('.right-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 切换右侧显示的学科
                    const subject = this.dataset.subject;
                    switchRightSubject(subject);
                    
                    // 更新左侧标签，使其与右侧同步
                    document.querySelectorAll('.tab').forEach(tab => {
                        tab.classList.remove('active');
                        if (tab.dataset.category === subject) {
                            tab.classList.add('active');
                        }
                    });
                    
                    // 加载对应类别的短语列表
                    loadPhraseList(subject);
                });
                
                rightTabsContainer.appendChild(tab);
            });
            
            // 默认显示数学学科
            switchRightSubject('math');
        }
        
        // 切换右侧显示的学科
        function switchRightSubject(subject) {
            // 隐藏所有学科反馈编辑区域
            document.querySelectorAll('.subject-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 显示当前学科
            const activeSection = document.getElementById(subject + 'Section');
            if (activeSection) {
                activeSection.classList.add('active');
            }
            
            // 更新右侧标题
            document.getElementById('currentSubjectName').textContent = subjectNames[subject];
        }
        
        // 加载短语列表显示
        function loadPhraseList(category) {
            const allPhrases = getAllPhrases();
            const phraseList = document.getElementById('phraseList');
            phraseList.innerHTML = '';
            
            // 获取当前类别的所有短语
            const categoryPhrases = allPhrases[category];
            let allItems = [];
            
            for (const type in categoryPhrases) {
                const typeName = getTypeName(type);
                categoryPhrases[type].forEach(phrase => {
                    allItems.push({
                        ...phrase,
                        type: type,
                        typeName: typeName
                    });
                });
            }
            
            // 显示短语
            allItems.forEach(phrase => {
                const phraseElement = document.createElement('div');
                phraseElement.className = `phrase-item ${category}`;
                phraseElement.dataset.id = phrase.id;
                phraseElement.dataset.category = category;
                phraseElement.dataset.type = phrase.type;
                phraseElement.dataset.text = phrase.text;
                
                phraseElement.innerHTML = `
                    <span class="category">${phrase.typeName}</span>
                    ${phrase.text}
                    ${phrase.isLocal ? '<span class="local-indicator">本地</span>' : ''}
                `;
                
                // 点击短语添加到右侧对应区域
                phraseElement.addEventListener('click', function() {
                    const subject = this.dataset.category;
                    const type = this.dataset.type;
                    const text = this.dataset.text;
                    
                    // 更新当前选择
                    if (type === 'problem') {
                        // 对于问题点，添加到数组
                        if (!currentSelections[subject][type].includes(text)) {
                            currentSelections[subject][type].push(text);
                        }
                    } else {
                        // 对于作业状态和后续建议，替换
                        currentSelections[subject][type] = text;
                    }
                    
                    // 更新显示
                    updateDisplay(subject, type);
                    
                    // 高亮显示已选短语
                    document.querySelectorAll('.phrase-item.selected').forEach(item => {
                        item.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    // 更新预览
                    generateFeedback();
                    
                    // 显示操作提示
                    showToast(`已添加到${getTypeName(type)}`);
                });
                
                phraseList.appendChild(phraseElement);
            });
            
            // 如果没有短语，显示提示
            if (allItems.length === 0) {
                phraseList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">暂无短语，请添加自定义短语</div>';
            }
        }
        
        // 更新显示
        function updateDisplay(subject, type) {
            // 根据类型确定元素ID的映射
            const elementIdMap = {
                'homework_status': {
                    text: `${subject}HomeworkText`,
                    display: `${subject}HomeworkStatusDisplay`
                },
                'problem': {
                    text: `${subject}ProblemText`,
                    display: `${subject}ProblemDisplay`
                },
                'suggestion': {
                    text: `${subject}SuggestionText`,
                    display: `${subject}SuggestionDisplay`
                }
            };
            
            const elementIds = elementIdMap[type];
            if (!elementIds) return;
            
            const displayElement = document.getElementById(elementIds.text);
            const displayStatus = document.getElementById(elementIds.display);
            
            if (displayElement && displayStatus) {
                if (type === 'problem') {
                    const problems = currentSelections[subject][type];
                    if (problems.length > 0) {
                        displayElement.textContent = problems.join('，');
                        displayElement.classList.remove('empty');
                        displayStatus.textContent = `已选择 ${problems.length} 个问题`;
                    } else {
                        displayElement.textContent = '点击左侧短语添加（可添加多个）';
                        displayElement.classList.add('empty');
                        displayStatus.textContent = '未选择';
                    }
                } else {
                    const value = currentSelections[subject][type];
                    if (value) {
                        displayElement.textContent = value;
                        displayElement.classList.remove('empty');
                        displayStatus.textContent = '已选择';
                    } else {
                        displayElement.textContent = type === 'homework_status' ? '点击左侧短语添加' : '点击左侧短语添加';
                        displayElement.classList.add('empty');
                        displayStatus.textContent = '未选择';
                    }
                }
            }
        }
        
        // 获取类型名称
        function getTypeName(type) {
            const typeNames = {
                'homework_status': '作业状态',
                'problem': '问题点',
                'suggestion': '后续建议'
            };
            return typeNames[type] || type;
        }
        
        // 设置标签页切换
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // 切换活动标签
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 加载对应类别的短语列表
                    const category = this.dataset.category;
                    loadPhraseList(category);
                    
                    // 同步右侧标签
                    document.querySelectorAll('.right-tab').forEach(rightTab => {
                        rightTab.classList.remove('active');
                        if (rightTab.dataset.subject === category) {
                            rightTab.classList.add('active');
                        }
                    });
                    
                    // 切换右侧显示的学科
                    switchRightSubject(category);
                });
            });
        }
        
        // 设置搜索功能
        function setupSearch() {
            const searchInput = document.getElementById('phraseSearch');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                const currentCategory = document.querySelector('.tab.active').dataset.category;
                const phraseItems = document.querySelectorAll(`.phrase-item.${currentCategory}`);
                
                if (searchTerm === '') {
                    phraseItems.forEach(item => {
                        item.style.display = 'block';
                    });
                    return;
                }
                
                phraseItems.forEach(item => {
                    const text = item.dataset.text.toLowerCase();
                    const pinyin = getPinyinForPhrase(item.dataset.id, currentCategory, item.dataset.type);
                    
                    // 匹配文本、拼音或首字母
                    const matchText = text.includes(searchTerm);
                    const matchPinyin = pinyin && pinyin.includes(searchTerm);
                    
                    // 检查是否是首字母匹配
                    let matchInitials = false;
                    if (searchTerm.length <= 3) {
                        const initials = pinyin ? pinyin.split('').filter(c => /[a-z]/.test(c)).join('') : '';
                        matchInitials = initials.startsWith(searchTerm);
                    }
                    
                    if (matchText || matchPinyin || matchInitials) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
        
        // 获取短语的拼音
        function getPinyinForPhrase(phraseId, category, type) {
            const allPhrases = getAllPhrases();
            const phrase = allPhrases[category][type].find(p => p.id === phraseId);
            return phrase ? phrase.pinyin : '';
        }
        
        // 设置按钮事件
        function setupButtonEvents() {
            // 生成反馈按钮
            document.getElementById('generateBtn').addEventListener('click', generateFeedback);
            
            // 重置按钮
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm('确定要重置所有选择吗？')) {
                    // 重置所有选择
                    currentSelections = {
                        math: { homework_status: null, problem: [], suggestion: null },
                        chinese: { homework_status: null, problem: [], suggestion: null },
                        english: { homework_status: null, problem: [], suggestion: null },
                        physics: { homework_status: null, problem: [], suggestion: null },
                        chemistry: { homework_status: null, problem: [], suggestion: null }
                    };
                    
                    // 更新所有显示
                    ['math', 'chinese', 'english', 'physics', 'chemistry'].forEach(subject => {
                        ['homework_status', 'problem', 'suggestion'].forEach(type => {
                            updateDisplay(subject, type);
                        });
                    });
                    
                    // 重置学生姓名和日期
                    document.getElementById('studentName').value = '';
                    document.getElementById('feedbackDate').value = getTodayDate();
                    document.getElementById('additionalNotes').value = '';
                    
                    // 清除短语选择高亮
                    document.querySelectorAll('.phrase-item.selected').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // 重新生成预览
                    generateFeedback();
                    
                    showToast('所有选择已重置');
                }
            });
            
            // 复制到剪贴板按钮
            document.getElementById('copyBtn').addEventListener('click', function() {
                const previewElement = document.getElementById('feedbackPreview');
                const previewText = previewElement.innerText || previewElement.textContent;
                
                if (!previewText.includes('生成的反馈内容将在此显示')) {
                    navigator.clipboard.writeText(previewText).then(() => {
                        showToast('反馈内容已复制到剪贴板');
                    }).catch(err => {
                        console.error('复制失败: ', err);
                        // 备用复制方法
                        const textArea = document.createElement('textarea');
                        textArea.value = previewText;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showToast('反馈内容已复制到剪贴板');
                    });
                } else {
                    showToast('请先生成有效的反馈内容');
                }
            });
            
            // 保存到本地语库按钮
            document.getElementById('saveLocalBtn').addEventListener('click', function() {
                const previewElement = document.getElementById('feedbackPreview');
                const previewText = previewElement.innerText || previewElement.textContent;
                
                if (previewText && !previewText.includes('生成的反馈内容将在此显示')) {
                    const phraseData = {
                        subject: 'math',
                        type: 'suggestion',
                        text: previewText.substring(0, 100) + (previewText.length > 100 ? '...' : '')
                    };
                    
                    if (saveToLocalPhrases(phraseData)) {
                        loadPhraseList(document.querySelector('.tab.active').dataset.category);
                        showToast('完整反馈已保存到本地语库');
                    } else {
                        showToast('该短语已存在于本地语库中');
                    }
                } else {
                    showToast('请先生成有效的反馈内容');
                }
            });
            
            // 添加自定义短语按钮
            document.getElementById('addCustomPhrase').addEventListener('click', function() {
                const subject = document.getElementById('customCategory').value;
                const type = document.getElementById('customType').value;
                const text = document.getElementById('customPhrase').value.trim();
                
                if (!text) {
                    showToast('请输入自定义短语内容');
                    return;
                }
                
                if (text.length < 3) {
                    showToast('短语内容太短，请输入至少3个字符');
                    return;
                }
                
                const phraseData = { subject, type, text };
                
                if (saveToLocalPhrases(phraseData)) {
                    // 重新加载短语列表
                    loadPhraseList(document.querySelector('.tab.active').dataset.category);
                    
                    // 清空输入框
                    document.getElementById('customPhrase').value = '';
                    
                    showToast('自定义短语已添加到本地语库');
                } else {
                    showToast('该短语已存在于本地语库中');
                }
            });
            
            // 导出词库按钮
            document.getElementById('exportBtn').addEventListener('click', exportLocalPhrases);
            
            // 导入词库按钮
            document.getElementById('importFile').addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    importLocalPhrases(file);
                    // 清空文件输入，以便再次选择同一文件
                    event.target.value = '';
                }
            });
            
            // 编辑按钮
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const subject = this.dataset.subject;
                    const type = this.dataset.type;
                    
                    if (type === 'problem') {
                        const currentProblems = currentSelections[subject][type];
                        const newText = prompt(`编辑${getTypeName(type)}（用逗号分隔多个问题点）：`, currentProblems.join('，'));
                        
                        if (newText !== null) {
                            if (newText.trim() === '') {
                                currentSelections[subject][type] = [];
                            } else {
                                currentSelections[subject][type] = newText.split('，').map(p => p.trim()).filter(p => p);
                            }
                            updateDisplay(subject, type);
                            generateFeedback();
                            showToast(`${getTypeName(type)}已更新`);
                        }
                    } else {
                        const currentValue = currentSelections[subject][type];
                        const newText = prompt(`编辑${getTypeName(type)}：`, currentValue || '');
                        
                        if (newText !== null) {
                            if (newText.trim() === '') {
                                currentSelections[subject][type] = null;
                            } else {
                                currentSelections[subject][type] = newText;
                            }
                            updateDisplay(subject, type);
                            generateFeedback();
                            showToast(`${getTypeName(type)}已更新`);
                        }
                    }
                });
            });
            
            // 清空按钮
            document.querySelectorAll('.clear-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const subject = this.dataset.subject;
                    const type = this.dataset.type;
                    
                    if (type === 'problem') {
                        currentSelections[subject][type] = [];
                    } else {
                        currentSelections[subject][type] = null;
                    }
                    
                    updateDisplay(subject, type);
                    generateFeedback();
                    
                    showToast(`${getTypeName(type)}已清空`);
                });
            });
            
            // 学生信息和日期变化时更新预览
            document.getElementById('studentName').addEventListener('input', generateFeedback);
            document.getElementById('feedbackDate').addEventListener('change', generateFeedback);
            document.getElementById('additionalNotes').addEventListener('input', generateFeedback);
            
            // 自定义短语输入框支持按Enter键添加
            document.getElementById('customPhrase').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('addCustomPhrase').click();
                }
            });
        }
        
        // 生成反馈内容
        function generateFeedback() {
            const studentName = document.getElementById('studentName').value || '学生';
            const feedbackDate = document.getElementById('feedbackDate').value;
            const additionalNotes = document.getElementById('additionalNotes').value;
            
            // 格式化日期
            let formattedDate = '';
            if (feedbackDate) {
                const dateObj = new Date(feedbackDate);
                const month = dateObj.getMonth() + 1;
                const day = dateObj.getDate();
                formattedDate = `${month}.${day}`;
            }
            
            // 构建完整反馈
            let feedback = `${formattedDate}${studentName}晚辅反馈\n\n`;
            
            // 数学反馈
            const mathHomework = currentSelections.math.homework_status;
            const mathProblems = currentSelections.math.problem;
            const mathSuggestion = currentSelections.math.suggestion;
            
            if (mathHomework) {
                feedback += `数学：${mathHomework}`;
                
                if (mathProblems.length > 0) {
                    feedback += `，问题集中在${mathProblems.join('，')}`;
                }
                
                if (mathSuggestion) {
                    feedback += `。${mathSuggestion}`;
                } else if (mathProblems.length > 0) {
                    feedback += '。';
                }
                
                feedback += '\n\n';
            }
            
            // 语文反馈
            const chineseHomework = currentSelections.chinese.homework_status;
            const chineseProblems = currentSelections.chinese.problem;
            const chineseSuggestion = currentSelections.chinese.suggestion;
            
            if (chineseHomework) {
                feedback += `语文：${chineseHomework}`;
                
                if (chineseProblems.length > 0) {
                    feedback += `，主要问题：${chineseProblems.join('，')}`;
                }
                
                if (chineseSuggestion) {
                    feedback += `。${chineseSuggestion}`;
                } else if (chineseProblems.length > 0) {
                    feedback += '。';
                }
                
                feedback += '\n\n';
            }
            
            // 英语反馈
            const englishHomework = currentSelections.english.homework_status;
            const englishProblems = currentSelections.english.problem;
            const englishSuggestion = currentSelections.english.suggestion;
            
            if (englishHomework) {
                feedback += `英语：${englishHomework}`;
                
                if (englishProblems.length > 0) {
                    feedback += `，主要问题：${englishProblems.join('，')}`;
                }
                
                if (englishSuggestion) {
                    feedback += `。${englishSuggestion}`;
                } else if (englishProblems.length > 0) {
                    feedback += '。';
                }
                
                feedback += '\n\n';
            }
            
            // 物理反馈
            const physicsHomework = currentSelections.physics.homework_status;
            const physicsProblems = currentSelections.physics.problem;
            const physicsSuggestion = currentSelections.physics.suggestion;
            
            if (physicsHomework) {
                feedback += `物理：${physicsHomework}`;
                
                if (physicsProblems.length > 0) {
                    feedback += `，主要问题：${physicsProblems.join('，')}`;
                }
                
                if (physicsSuggestion) {
                    feedback += `。${physicsSuggestion}`;
                } else if (physicsProblems.length > 0) {
                    feedback += '。';
                }
                
                feedback += '\n\n';
            }
            
            // 化学反馈
            const chemistryHomework = currentSelections.chemistry.homework_status;
            const chemistryProblems = currentSelections.chemistry.problem;
            const chemistrySuggestion = currentSelections.chemistry.suggestion;
            
            if (chemistryHomework) {
                feedback += `化学：${chemistryHomework}`;
                
                if (chemistryProblems.length > 0) {
                    feedback += `，主要问题：${chemistryProblems.join('，')}`;
                }
                
                if (chemistrySuggestion) {
                    feedback += `。${chemistrySuggestion}`;
                } else if (chemistryProblems.length > 0) {
                    feedback += '。';
                }
                
                feedback += '\n\n';
            }
            
            if (additionalNotes) {
                feedback += `${additionalNotes}\n\n`;
            }
            
            // 更新预览区域
            document.getElementById('feedbackPreview').innerHTML = `
                <div class="preview-title">${formattedDate}${studentName}晚辅反馈</div>
                <div>${feedback.replace(/\n/g, '<br>')}</div>
            `;
        }
        
        // 显示提示消息
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>